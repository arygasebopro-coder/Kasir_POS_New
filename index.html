<!DOCTYPE html>
<html>
<head>
  <title>Tes Koneksi ke Server Kasir</title>
</head>
<body>
  <h1>Membuka Halaman Tes...</h1>
  <p>Buka Console (tekan F12) untuk melihat laporan debugging.</p>
  <pre id="log" style="white-space: pre-wrap; word-wrap: break-word;"></pre>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzYgVjZx9aefI6McP-8HMKFckXLrHGLQmd5Q4AwAkbAh4k-5MRxUCM5DoZe35chZg460w/exec';
    const logElement = document.getElementById('log');

    function log(message) {
      console.log(message);
      logElement.textContent += message + '\n';
    }

    async function testConnection() {
      log('--- MEMULAI TES KONEKSI SISTEMATIS ---');
      log(`1. URL Target: ${SCRIPT_URL}`);

      try {
        log('2. Mencoba mengirim permintaan (fetch)...');
        const response = await fetch(SCRIPT_URL);
        log(`3. Menerima respons dari server. Status: ${response.status} (${response.statusText})`);

        if (!response.ok) {
          throw new Error(`Server merespons dengan error.`);
        }

        log('4. Mencoba membaca data sebagai JSON...');
        const result = await response.json();
        log('5. Berhasil membaca data JSON dari server.');

        if (result.success) {
          log('--- HASIL TES: BERHASIL! ---');
          log(`Server melaporkan sukses. Jumlah produk yang diterima: ${result.data.length}`);
          if(result.data.length > 0) {
            log('Data pertama: ' + JSON.stringify(result.data[0]));
          }
        } else {
          throw new Error(`Server melaporkan kegagalan: ${result.error}`);
        }

      } catch (error) {
        log('--- HASIL TES: GAGAL! ---');
        log(`Terjadi error pada salah satu langkah.`);
        log(`Pesan Error: ${error.message}`);
        log('Ini biasanya terjadi karena masalah izin (CORS) atau kesalahan pada URL/Deployment. Pastikan Anda sudah melakukan deployment ulang dengan "Versi Baru" setelah mengganti kode Code.gs.');
      }
    }

    // Jalankan tes saat halaman dimuat
    testConnection();
  </script>
</body>
</html>

