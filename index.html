<!DOCTYPE html>
<html>
<head>
  <title>Tes Koneksi ke Server Kasir</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    pre { background-color: #eee; padding: 15px; border: 1px solid #ccc; white-space: pre-wrap; word-wrap: break-word; }
    .success { color: green; font-weight: bold; font-size: 1.2em; }
    .fail { color: red; font-weight: bold; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>Tes Koneksi Sistematis v3.0</h1>
  <p>Laporan debugging akan muncul di bawah ini.</p>
  <pre id="log"></pre>

  <script>
    // URL Deployment baru Anda sudah dimasukkan di bawah
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzP_tdcYOPD5ShU52d5zM62dVftPDvC67EkgVWfQF-8QtRs7JXyRjcd_-qHZYfMmkNNcw/exec';
    const logElement = document.getElementById('log');

    function log(message, type = '') {
      console.log(message);
      const line = document.createElement('div');
      line.textContent = message;
      if (type) {
        line.className = type;
      }
      logElement.appendChild(line);
    }

    async function testConnection() {
      log('--- MEMULAI TES KONEKSI v3.0 ---');
      log(`1. URL Target: ${SCRIPT_URL}`);

      if (SCRIPT_URL.includes('GANTI_DENGAN_URL')) {
        log('--- HASIL TES: GAGAL! ---', 'fail');
        log('Pesan Error: Anda belum memasukkan URL deployment baru di file index.html.');
        return;
      }

      try {
        log('2. Mencoba mengirim permintaan (fetch)...');
        const response = await fetch(SCRIPT_URL);
        log(`3. Menerima respons dari server. Status: ${response.status}`);

        if (!response.ok) throw new Error(`Server merespons dengan error.`);

        const result = await response.json();
        log('4. Berhasil membaca data JSON dari server.');

        if (result.success && result.version === "3.0") {
          log('--- HASIL TES: BERHASIL! ---', 'success');
          log(`Versi Server: ${result.version}`);
          log(`Pesan dari Server: ${result.message}`);
          log('Koneksi sudah 100% benar. Kita bisa melanjutkan ke aplikasi kasir lengkap.');
        } else {
          throw new Error(`Server masih menjalankan versi lama atau melaporkan error.`);
        }

      } catch (error) {
        log('--- HASIL TES: GAGAL! ---', 'fail');
        log(`Pesan Error: ${error.message}`);
        log('Ini membuktikan masih ada masalah pada proses deployment atau URL yang dimasukkan.');
      }
    }

    testConnection();
  </script>
</body>
</html>

