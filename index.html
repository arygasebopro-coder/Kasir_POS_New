<!DOCTYPE html>
<html>
<head>
  <title>Tes Koneksi ke Server Kasir</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    pre { background-color: #eee; padding: 15px; border: 1px solid #ccc; white-space: pre-wrap; word-wrap: break-word; }
    .success { color: green; font-weight: bold; font-size: 1.2em; }
    .fail { color: red; font-weight: bold; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>Tes Koneksi Sistematis v2.0</h1>
  <p>Laporan debugging akan muncul di bawah ini.</p>
  <pre id="log"></pre>

  <script>
    // URL Deployment baru Anda sudah dimasukkan di bawah
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyWFSJX8LdG49luoW0GhC6kWBGgfF65GTkSaEkQTp-E2ILS7hhYx-82e-_dUd5t_ycHNg/exec';
    const logElement = document.getElementById('log');

    function log(message, type = '') {
      console.log(message);
      const line = document.createElement('div');
      line.textContent = message;
      if (type) {
        line.className = type;
      }
      logElement.appendChild(line);
    }

    async function testConnection() {
      log('--- MEMULAI TES KONEKSI v2.0 ---');
      log(`1. URL Target: ${SCRIPT_URL}`);

      try {
        log('2. Mencoba mengirim permintaan (fetch)...');
        const response = await fetch(SCRIPT_URL);
        log(`3. Menerima respons dari server. Status: ${response.status}`);

        if (!response.ok) throw new Error(`Server merespons dengan error.`);

        const result = await response.json();
        log('4. Berhasil membaca data JSON dari server.');

        if (result.success && result.version === "2.0") {
          log('--- HASIL TES: BERHASIL! ---', 'success');
          log(`Versi Server: ${result.version}`);
          log(`Pesan dari Server: ${result.message}`);
          log('Ini membuktikan server sudah diperbarui dan koneksi sudah benar!');
        } else {
          throw new Error(`Server masih menjalankan versi lama atau melaporkan error. Respons: ${JSON.stringify(result)}`);
        }

      } catch (error) {
        log('--- HASIL TES: GAGAL! ---', 'fail');
        log(`Pesan Error: ${error.message}`);
        log('Ini membuktikan proses deployment belum berhasil. Harap ulangi panduan deployment dengan teliti, pastikan memilih "New version".');
      }
    }

    testConnection();
  </script>
</body>
</html>

